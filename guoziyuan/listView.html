<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>列表</title>
    <!--<script src="jquery-3.2.1/jquery-3.2.1.min.js"></script>-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


    <script>
        $(document).bind("scroll", srcollEvent);
        $(document).bind("touchstart", startEvent).bind("touchmove", moveEvent).bind("touchcancel", stopEvent).bind("touchend", stopEvent);
        var isScrollStop = true;  //页面是否停止滚动 防止屏幕有滑动但还没到底部就开始加载数据
        var isMoveDown = false;  //防止手指向上滑动屏幕开始加载数据
        var isLoading = false;   //防止异步请求数据未返回到前端的时候重复提交请求
        var isMoved = false;   //手指是否在滑动屏幕 防止出现手指触摸屏幕而没有滑动就加载数据
        var startY = 0;
        var startX = 0;
        function srcollEvent() {
            if ($(document).scrollTop() > 0) {
                isScrollStop = false;
            }
            //如果是左右滑动异步加载数据就用下面的代码
            /*
             if ($(document).scrollLeft() > 0) {
             isScrollStop = false;
             }*/
        }
        function startEvent() {
            startY = event.targetTouches[0].clientY;
            //如果是左右滑动加载数据就用下面的代码
            //startX = event.targetTouches[0].clientX;
            isScrollStop = true;
            isMoved = false;
            isMoveDown = false;
        }
        function moveEvent() {
            var Y = event.targetTouches[0].clientY;
            if (startY > Y) {
                isMoveDown = true;
            }
            else {
                isMoveDown = false;
            }
            //如果是左右滑动加载数据就用下面的代码
            /*var X = event.targetTouches[0].clientX;
             if (startX > X) {
             isMoveDown = true;
             } else {
             isMoveDown = false;
             }*/
            isMoved = true;
            
<!--            console.log(scrollTop);-->
<!--            if(document.documentElement.scrollHeight == document.documentElement.clientHeight + scrollTop ) {-->
<!--                alert("到底部啦");-->
<!--                stopEvent();-->
<!--            }-->
            
        }
        function stopEvent() {
            
            
            
       
            
            
            console.log("分页加载");
            
            if (isScrollStop && isMoved && !isLoading && isMoveDown) {
                console.log("分页加载");
                loadData();
            }
        }
        var index = 0;
        function loadData() {   //模拟向后台异步加载数据
            isLoading = true;    //异步加载数据之前先设置为正在等待数据
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + index + "</td></tr>");
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + (index+1) + "</td></tr>");
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + (index+2) + "</td></tr>");
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + (index+3) + "</td></tr>");
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + (index+4) + "</td></tr>");
            $("table").append("<tr onclick=\"OnTrClick(this)\"><td>异步加载数据" + (index+5) + "</td></tr>");
        
            
            //此时数据已返回到前端
            index+=6;
            isLoading = false;
            isMoved = false;
            
            
            var message = {"method":"refreshed"}
            window.webkit.messageHandlers.interOp.postMessage(message)
            
            
        }
        function sleep() {
            var t1 = new Date();
            var t2 = new Date();
            while ((t2 - t1) < 3000) {
                t2 = new Date();
            }
        }
    
    
    
    
    
    /*
      $(document).ready(function(){
          $("table tr").each(function(){
                  $(this).on("click", function()){
                 alert("每一行的点击事件，具体实现就按自己要求写了");
                             
                             
                            // var itemName = $(this).children("td")[0];
                             //var message = {"method":"clickLine","name":itemName}
                           //  window.webkit.messageHandlers.interOp.postMessage(message)
                             //});
     
                        
                   }
              });
       });
     */
      
      //获取当前控件的点击效果:
      
   		function OnTrClick(btn){
        var itemName = $(btn).children("td")[0].innerHTML;
        
        var message = {"method":"clickLine","name":itemName}
         window.webkit.messageHandlers.interOp.postMessage(message)
         }
    
   
   //添加点击事件
    $(function() {
    $(".goodsItem").click(function() {
                          //var num = parseInt($("#cartNums").text());
                          //$("#cartNums").text(num+1);
                          //var itemName = $(this).children("td")[0].title;
                          
                          var itemName = $(this).children("td")[0].innerHTML;
                          
                          var message = {"method":"clickLine","name":itemName}
                          window.webkit.messageHandlers.interOp.postMessage(message)
    });
                          
     });                     
   
   
     

      
                                         
    </script>


</head>
<body>
<table style="font-size:100px" id="table1">
 
    <tr class="goodsItem">
<!--        <td onclick="showView(this)" title="23434">测试数据1</td>-->
   <td onclick="showView(this)" title="23434">测试数据1</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据2</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据3</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据4</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据5</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据6</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据7</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据1</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据2</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据3</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据4</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据5</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据6</td>
    </tr>
    <tr class="goodsItem">
        <td>测试数据7</td>
    </tr>
   
</table>
</body>
</html>
